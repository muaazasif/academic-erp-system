{% extends "base.html" %}

{% block title %}Assign Mid-Term - ERP System{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        {% include 'sidebar.html' %}

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Assign Mid-Term: {{ midterm.title }}</h1>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <form method="POST">
                        <div class="mb-3">
                            <h5>Assign to Students</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="assignToAll" name="assign_to_all" onchange="toggleStudentSelection()">
                                <label class="form-check-label" for="assignToAll">
                                    Assign to all students
                                </label>
                            </div>

                            <div id="studentSelection">
                                <p>Select individual students:</p>
                                {% for student in students %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="students" value="{{ student.student_id }}" id="student{{ student.id }}">
                                    <label class="form-check-label" for="student{{ student.id }}">
                                        {{ student.name }} (ID: {{ student.student_id }})
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Assign Mid-Term</button>
                        <a href="{{ url_for('admin_midterms') }}" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>

            <script>
            function toggleStudentSelection() {
                const assignToAllCheckbox = document.getElementById('assignToAll');
                const studentSelectionDiv = document.getElementById('studentSelection');

                if (assignToAllCheckbox.checked) {
                    // Disable individual student selection when "Assign to all" is checked
                    const checkboxes = studentSelectionDiv.querySelectorAll('input[type="checkbox"][name="students"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.disabled = true;
                        checkbox.checked = false;
                    });
                } else {
                    // Enable individual student selection
                    const checkboxes = studentSelectionDiv.querySelectorAll('input[type="checkbox"][name="students"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.disabled = false;
                    });
                }
            }
            </script>
        </main>
    </div>
</div>
{% endblock %}