{% extends "base.html" %}

{% block title %}Mid-Term Submissions - ERP System{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        {% include 'sidebar.html' %}

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Submissions for: {{ midterm.title }}</h1>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Assigned Sheets</th>
                            <th>Status</th>
                            <th>Submitted At</th>
                            <th>Grade</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in submissions %}
                        <tr>
                            <td>{{ submission.student.student_id }}</td>
                            <td>{{ submission.student.name }}</td>
                            <td>{{ submission.assigned_sheets }}</td>
                            <td>
                                <span class="badge
                                    {% if submission.status == 'submitted' %}bg-warning{% elif submission.status == 'graded' %}bg-success{% else %}bg-info{% endif %}">
                                    {{ submission.status|title }}
                                </span>
                            </td>
                            <td>{{ submission.submitted_at.strftime('%Y-%m-%d %H:%M') if submission.submitted_at else '-' }}</td>
                            <td>{{ "%.2f"|format(submission.grade) if submission.grade else '-' }}</td>
                            <td>
                                {% if submission.submission_file_path %}
                                    <a href="{{ submission.submission_file_path }}" class="btn btn-info btn-sm" target="_blank">Download</a>
                                {% else %}
                                    -
                                {% endif %}
                                {% if submission.status != 'graded' %}
                                    <a href="{{ url_for('grade_midterm_submission', midterm_id=midterm.id, student_id=submission.student_id) }}" class="btn btn-success btn-sm">Grade</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <a href="{{ url_for('admin_midterms') }}" class="btn btn-secondary">Back to Mid-Terms</a>
        </main>
    </div>
</div>
{% endblock %}